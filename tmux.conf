##### ======================
##### PREFIX & BASICS
##### ======================

# Unbind default prefix
unbind C-b

# Set tmux prefix to Ctrl+Space for command mode
set-option -g prefix C-Space
bind C-Space send-prefix

# Enable mouse
set -g mouse on

# Use Emacs keybindings in copy mode
setw -g mode-keys emacs

# Clipboard integration
set-option -g set-clipboard on


##### ======================
##### UNBIND ALL CONFLICTING DEFAULTS
##### ======================

# Unbind everything we’re reclaiming for Emacs or shell use
unbind C-o       # Default: rotate panes
unbind C-x       # Default: suspend or custom user binds
unbind C-c       # Default: break pane or window
unbind C-b       # Default prefix
unbind-key -n C-o
unbind-key -n C-x
unbind-key -n C-c

# Also clear any key-table leftovers (safety)
unbind -T root C-o
unbind -T root C-x
unbind -T root C-c


##### ======================
##### WINDOW NAVIGATION
##### ======================

bind -n C-Left  previous-window
bind -n C-Right next-window


##### ======================
##### EMACS-LIKE OPERATIONS USING C-a
##### ======================

# C-a → enter our custom key table
bind -n C-a switch-client -T emacs-prefix

# In emacs-prefix table:
bind -T emacs-prefix 2 split-window -v \; display-message "Split below (C-a 2)"
bind -T emacs-prefix 3 split-window -h \; display-message "Split right (C-a 3)"
bind -T emacs-prefix 0 kill-pane \; display-message "Closed pane (C-a 0)"
bind -T emacs-prefix 1 kill-pane -a \; display-message "Closed other panes (C-a 1)"
bind -T emacs-prefix o display-panes
bind -T emacs-prefix C-o display-panes

# Show pane numbers for 5 seconds instead of 1
set -g display-panes-time 5000

# Optional: toggle between last two panes (like screen)
bind -T emacs-prefix a last-pane

# Cancel sequence
bind -T emacs-prefix Escape switch-client -T root
bind -T emacs-prefix C-g switch-client -T root


##### ======================
##### COPY MODE KEYBINDINGS
##### ======================

# Enter copy mode
bind-key [ copy-mode

# Start selection (C-Space)
bind-key -T copy-mode C-Space send -X begin-selection

# Copy selection (M-w)
bind-key -T copy-mode M-w send -X copy-pipe "pbcopy"

# Cut selection (C-w)
bind-key -T copy-mode C-w send -X copy-pipe-and-cancel "pbcopy"

# Paste from system clipboard (C-y)
bind-key -n C-y run-shell "pbpaste | tmux load-buffer - && tmux paste-buffer"


##### ======================
##### STATUS BAR TWEAK
##### ======================

# Highlight active window instead of showing '*'
set -g window-status-format ' #I:#W '
set -g window-status-current-format '#[bg=blue,fg=white,bold] #I:#W #[default]'

# Minimal, clean look
set -g status-bg black
set -g status-fg white
set -g status-left ''
set -g status-right '#[fg=green]#H#[default] #[fg=yellow]%H:%M#[default]'

### --- SWAP WINDOWS (C-M-Left / C-M-Right) ---

# Swap current window left and stay focused
bind -n C-M-Left run-shell '
current=$(tmux display-message -p "#I");
tmux swap-window -t $((current - 1));
tmux select-window -t $((current - 1))
'

# Swap current window right and stay focused
bind -n C-M-Right run-shell '
current=$(tmux display-message -p "#I");
tmux swap-window -t $((current + 1));
tmux select-window -t $((current + 1))
'

set -g renumber-windows on
